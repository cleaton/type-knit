"use strict";var T=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var C=(t,r)=>{for(var a in r)T(t,a,{get:r[a],enumerable:!0})},g=(t,r,a,e)=>{if(r&&typeof r=="object"||typeof r=="function")for(let c of _(r))!S.call(t,c)&&c!==a&&T(t,c,{get:()=>r[c],enumerable:!(e=h(r,c))||e.enumerable});return t};var R=t=>g(T({},"__esModule",{value:!0}),t);var q={};C(q,{TKBuilder:()=>u});module.exports=R(q);var m=require("zod"),i=m.z.object({username:m.z.string()}),u=class{constructor(){}instance(r,a,e,c=[]){return{_type:"instance",_schema:e,_middlewares:c,instance:(y,d)=>({fetch:a(y,d)})}}call(r,a,e=[]){return{_type:"call",_schema:r,_middlewares:e,call:a}}stream(r,a,e=[]){return{_type:"stream",_schema:r,_middlewares:e,stream:a}}router(r,a=[]){return{...r,_middlewares:a,_type:"router",route:async e=>{let y=new URL(e.req.url).pathname.split("/");y.shift();let d=y.shift();console.log("paths",y),console.log("first",d);for(let p of a){let n=p.handle(e);if(n.type=="response")return n.data;e=n.data}if(!e.__tk_internals){let n=new URL(e.req.url).pathname.split("/");n.shift();let s=await e.req.json();if(typeof s!="object")return console.log("bad req"),new Response("bad request",{status:400});if(s.args=s.args?s.args:[],!Array.isArray(s.args))return console.log("bad args",s.args),new Response("bad request",{status:400});e.__tk_internals={index:0,paths:n,tkreq:s}}let l=r[e.__tk_internals.paths[e.__tk_internals.index]];switch(console.log("obj",e.__tk_internals.paths,e.__tk_internals.index,l),l._type){case"call":{let p=e.__tk_internals.tkreq.args.shift();console.log("payload",p);let n=l._schema.safeParse(p),s=l.call(n.data,e);if(s.error){let x=s.status?s.status:400;return new Response(s.error,{status:x})}return new Response(JSON.stringify(s),{status:200})}case"stream":{let p=await e.req.json(),n=l._schema.safeParse(p),s=l.stream(n,e);return new Response(JSON.stringify("TODO"),{status:200})}case"instance":{let p=await e.req.json(),n=l._schema.safeParse(p),{fetch:s}=l.instance(n,e);return s(e.req)}case"router":return++e.__tk_internals.index,l.route(e)}return new Response("route not found",{status:404})}}}},o=new u,z=o.router({other:{_type:"call",_middlewares:[],_schema:i,call:t=>"hi"}}),f=o.router({test2:o.call(i,t=>t.username)}),K=o.router({test2:o.call(i,t=>t.username)}),b=o.router({test:o.call(i,t=>13),subrouter:f,instancerouter:o.instance(K,(t,r)=>fetch,i),st:o.stream(i,t=>({topic:"test",initValue:1234}))});var M=o.call(i,t=>t.username),w={f:()=>t=>({test:"hi"})};w.f()({hi:"hello"});0&&(module.exports={TKBuilder});
