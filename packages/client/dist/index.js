"use strict";var u=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var m=Object.prototype.hasOwnProperty;var w=(t,e)=>{for(var r in e)u(t,r,{get:e[r],enumerable:!0})},P=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of g(e))!m.call(t,n)&&n!==r&&u(t,n,{get:()=>e[n],enumerable:!(s=R(e,n))||s.enumerable});return t};var q=t=>P(u({},"__esModule",{value:!0}),t);var S={};w(S,{createClient:()=>O});module.exports=q(S);function f(t,e){return r=>{let s=new URL(t.url);s.pathname=s.pathname+t.execPath,t.execArgs.push(r);let n=new t.impl.Request(s,{...t.options,body:JSON.stringify({args:t.execArgs})});return e(n)}}var d=class{constructor(e){this.req=e;this.cancelled=!1}async cancel(){var e;this.cancelled=!0,(e=this.reader)==null||e.cancel()}async start(e){e({state:"connecting"});let r=await fetch(this.req);e({state:"connected"});let s=r.body,n;if(s){this.reader=s.pipeThrough(new TextDecoderStream).getReader();let c="",o=!1;for(;!this.cancelled;){let{done:h,value:l}=await this.reader.read();if(h){o=!0;break}if(l){let a=l.indexOf(`
`);if(a){c+=l.slice(0,a);let i=JSON.parse(c);n=i,e({state:"data",data:i}),c=l.slice(a+1)}else c+=l}}o&&e({state:"done",lastData:n})}}},p={get(t,e,r){let s=e;switch(t.execPath=t.execPath?t.execPath+"/"+s:s,e){case"call":return f(t,n=>fetch(n).then(c=>c.json()));case"stream":return f(t,n=>new d(n));case"instance":return async n=>(t.execArgs.push(n),new Proxy(t,p));default:return new Proxy(t,p)}}};function O(t,e,r){let s=r||{fetch:global.fetch,Request:global.Request,Response:global.Response},n={method:"POST"},c={"content-type":"application/json"},o=e||{},h=e!=null&&e.headers?e.headers:{},l=new URL(t);return{e:a=>{a=a||{};let i=a!=null&&a.headers?a.headers:{},x={...h,...i,...c},y={...o,...a,...n,headers:x},T={url:l,options:y,impl:s,execArgs:[]};return new Proxy(T,p)}}}0&&(module.exports={createClient});
